# Log Analysis & Lineage Rules

# Log Entries: log_id, seq_id, timestamp, payload
:create log_entry {
    log_id: uuid,
    seq_id: int,
    =>
    ts: int,
    payload: any
}

# Lineage: DerivedLog -> SourceLog
:create log_derivation {
    derived_log: uuid,
    source_log: uuid,
    agent_id: uuid
}

# Finding the "Latest Truth": Get the most recent entry for a specific key in a log
latest_fact(log_id, key, value) :-
    log_entry{log_id: log_id, seq_id: S1, payload: P},
    P.key == key,
    value = P.value,
    not (log_entry{log_id: log_id, seq_id: S2}, S2 > S1, P2.key == key)

# Temporal Search: Find entries within a time window
in_window(log_id, start_ts, end_ts, entry_payload) :-
    log_entry{log_id: log_id, ts: T, payload: entry_payload},
    T >= start_ts,
    T <= end_ts

# Synthesis Tracking: What logs were affected by this event?
affected_logs(derived_log, event_id) :-
    log_derivation{derived_log: derived_log, source_log: source},
    log_entry{log_id: source, seq_id: event_id}
affected_logs(deep_derived, event_id) :-
    log_derivation{derived_log: deep_derived, source_log: intermediate},
    affected_logs(intermediate, event_id)
