# Actor Model Interface Clarification

## User Requirement (2026-01-16)

**Key Insight:** Actors should NEVER directly call `system.send()` or interact with System explicitly.

## Interface Rules

### External Interface (code outside actor system)
- `system.receive(message)` - inject messages from external sources
- `system.sendTo(actorId, message)` - convenience method for routing

### Actor Interface (what actors see/use)
- `receive(message)` - PUBLIC: handle incoming messages
- `send(targetId, message)` - PROTECTED: send to other actors
  - Internally routes through `this.system.receive(...)`
  - Actor code never mentions "system"
  - Like Erlang's `Pid ! Message` syntax

## Actor Code Pattern

```typescript
class MyActor extends BaseActor {
  async receive(message: Message): Promise<Response> {
    // Process incoming message

    // Need to coordinate with another actor?
    const response = await this.send("other-actor-id", {
      id: crypto.randomUUID(),
      type: "request",
      payload: { data: "something" }
    });

    return { success: true };
  }
}
```

**Note:** No System in actor code! The `send()` method is on BaseActor and handles routing internally.

## Why This Matters

1. **Simplicity:** Actors just call `this.send()` - no System knowledge needed
2. **Erlang-like:** Similar to `Pid ! Message` - just send to an address
3. **Encapsulation:** System is implementation detail, not part of actor API
4. **Only external code** needs to call `system.sendTo()` to inject messages

## Implementation

```typescript
export abstract class BaseActor implements Actor {
  protected system?: System;

  setSystem(system: System): void {
    this.system = system;
  }

  // Actors call this to send to other actors
  protected async send(targetId: string, message: Message): Promise<Response> {
    if (!this.system) {
      throw new Error("Actor not registered with System");
    }
    return this.system.receive({
      id: crypto.randomUUID(),
      type: 'route',
      payload: { targetId, message },
      sender: this.id
    });
  }

  abstract receive(message: Message): Promise<Response>;
}
```

## Examples Should Show

1. External code using `system.sendTo()`
2. Actor code using `this.send()` (not `system.send()`)
3. No System references in actor implementations
4. System.receive() handling internal routing
