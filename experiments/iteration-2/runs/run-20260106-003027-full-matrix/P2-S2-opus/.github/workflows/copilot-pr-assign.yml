name: Auto-Assign PR to Owner

on:
  pull_request:
    types: [opened]

permissions:
  pull-requests: write

jobs:
  assign-owner:
    runs-on: ubuntu-latest
    steps:
      - name: Get repository owner
        id: get-owner
        run: |
          echo "owner=${{ github.repository_owner }}" >> "$GITHUB_OUTPUT"

      - name: Assign PR to owner
        uses: actions/github-script@v7
        with:
          script: |
            const owner = '${{ steps.get-owner.outputs.owner }}';
            const prNumber = context.payload.pull_request.number;

            try {
              await github.rest.issues.addAssignees({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                assignees: [owner]
              });

              console.log(`Assigned PR #${prNumber} to ${owner}`);
            } catch (error) {
              console.error(`Failed to assign PR: ${error.message}`);
              core.setFailed(`Failed to assign PR to ${owner}`);
            }

      - name: Add assignment comment
        uses: actions/github-script@v7
        with:
          script: |
            const owner = '${{ steps.get-owner.outputs.owner }}';
            const prNumber = context.payload.pull_request.number;

            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: `This PR has been automatically assigned to @${owner} for review.\n\n_Auto-assigned by copilot-pr-assign workflow._`
            });
