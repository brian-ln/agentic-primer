// Base Entity Definition for Domain Model
//
// Entities are typed domain objects that extend nodes with lifecycle and semantics.

package convergence:domain-entity@0.1.0;

use self.address.{address};
use agentic-primer:types@0.1.0.{json-value};

/// Entity kind discriminator
enum entity-kind {
    agent,
    task,
    session,
    human,
    model,
    provider,
    program,
}

/// Entity lifecycle states (for programs)
enum entity-lifecycle {
    draft,
    published,
    deprecated,
}

/// Entity metadata
record entity-metadata {
    kind: entity-kind,
    lifecycle: option<entity-lifecycle>,
    version: u32,
    created: u64,
    modified: u64,
}

/// Base entity interface
///
/// All domain entities implement this interface.
/// Entities are specialized nodes with typed semantics.
resource entity {
    /// Get entity's unique address
    get-address: func() -> address;

    /// Get entity kind
    get-kind: func() -> entity-kind;

    /// Get entity metadata
    get-metadata: func() -> entity-metadata;

    /// Get entity configuration as JSON
    get-config: func() -> json-value;

    /// Update entity configuration
    update-config: func(config: json-value) -> result<_, string>;

    /// Serialize to JSON
    to-json: func() -> json-value;
}

/// Entity factory and query interface
interface entity-ops {
    use self.address.{address};

    /// Create entity from kind and configuration
    create-entity: func(
        id: string,
        kind: entity-kind,
        config: json-value
    ) -> result<address, string>;

    /// Get entity by address
    get-entity: func(addr: address) -> result<entity, string>;

    /// Delete entity
    delete-entity: func(addr: address) -> result<_, string>;

    /// List entities by kind
    list-by-kind: func(kind: entity-kind) -> list<address>;

    /// List entities by lifecycle
    list-by-lifecycle: func(lifecycle: entity-lifecycle) -> list<address>;
}
