// Convergence Detection for Knowledge Synthesis
//
// Detects when multiple exploration paths converge to similar conclusions.

package convergence:domain-knowledge@0.1.0;

use self.address.{address};

/// Convergence signal strength
enum convergence-strength {
    weak,
    moderate,
    strong,
}

/// Convergence detection result
record convergence-detection {
    /// Converging nodes/paths
    nodes: list<address>,
    /// Strength of convergence
    strength: convergence-strength,
    /// Similarity score (0.0 to 1.0)
    similarity: float64,
    /// Semantic theme
    theme: option<string>,
    /// Timestamp
    detected-at: u64,
}

/// Convergence tracking options
record convergence-options {
    /// Minimum similarity threshold
    min-similarity: float64,
    /// Minimum nodes for convergence
    min-nodes: u32,
    /// Time window for detection (ms)
    time-window: u64,
}

/// Convergence detection interface
interface convergence {
    use self.address.{address};

    /// Detect convergence among a set of nodes
    ///
    /// Analyzes semantic similarity and clustering to identify
    /// groups of nodes that converge on similar conclusions.
    detect-convergence: func(
        nodes: list<address>,
        options: convergence-options
    ) -> result<list<convergence-detection>, string>;

    /// Monitor ongoing convergence
    ///
    /// Track nodes as they're created/updated and detect emerging patterns.
    /// Returns convergence events as they occur.
    monitor-convergence: func(
        node-type: option<string>,
        options: convergence-options
    ) -> result<_, string>;

    /// Get convergence history
    get-convergence-history: func(limit: u32) -> list<convergence-detection>;

    /// Check if nodes are converging
    are-converging: func(
        nodes: list<address>,
        threshold: float64
    ) -> result<bool, string>;

    /// Extract common theme from converging nodes
    extract-theme: func(nodes: list<address>) -> result<string, string>;
}
