// Success Criteria for Task Evaluation
//
// Defines criteria specifications and evaluation logic for determining task completion.

package convergence:domain-query@0.1.0;

use self.address.{address};
use agentic-primer:types@0.1.0.{json-value};

/// Criterion evaluation result
enum criterion-result {
    pass,
    fail,
    inconclusive,
}

/// Common criterion types
enum criterion-type {
    file-exists,
    word-count,
    pattern-match,
    custom,
}

/// File existence criterion parameters
record file-exists-params {
    path: string,
}

/// Word count criterion parameters
record word-count-params {
    min-words: option<u32>,
    max-words: option<u32>,
    text-source: string,
}

/// Pattern match criterion parameters
record pattern-match-params {
    pattern: string,
    text-source: string,
    must-match: bool,
}

/// Custom criterion parameters
record custom-params {
    evaluator-code: string,
    params: json-value,
}

/// Criterion specification
variant criterion-spec {
    file-exists(file-exists-params),
    word-count(word-count-params),
    pattern-match(pattern-match-params),
    custom(custom-params),
}

/// Evaluation context
record eval-context {
    /// Task being evaluated
    task: address,
    /// Evaluation timestamp
    timestamp: u64,
    /// Additional context data
    context: json-value,
}

/// Evaluation result with details
record evaluation-result {
    result: criterion-result,
    reason: option<string>,
    details: option<json-value>,
}

/// Success criteria evaluation interface
interface criteria {
    use self.address.{address};

    /// Evaluate a single criterion
    evaluate-criterion: func(
        spec: criterion-spec,
        context: eval-context
    ) -> result<evaluation-result, string>;

    /// Evaluate multiple criteria (AND logic)
    evaluate-all: func(
        specs: list<criterion-spec>,
        context: eval-context
    ) -> result<evaluation-result, string>;

    /// Evaluate multiple criteria (OR logic)
    evaluate-any: func(
        specs: list<criterion-spec>,
        context: eval-context
    ) -> result<evaluation-result, string>;

    /// Register custom evaluator
    register-evaluator: func(
        name: string,
        evaluator-code: string
    ) -> result<_, string>;

    /// List registered evaluators
    list-evaluators: func() -> list<string>;
}
