{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "shared-message.schema.json",
  "title": "SharedMessage",
  "description": "The universal message envelope for all Signal Hub communication",
  "type": "object",
  "required": ["type", "from", "to", "payload"],
  "properties": {
    "type": {
      "type": "string",
      "description": "Message type identifier (e.g., hub:connect, hub:send)",
      "examples": ["hub:connect", "hub:send", "hub:publish"]
    },
    "from": {
      "$ref": "canonical-address.schema.json#/definitions/CanonicalAddress",
      "description": "Sender's canonical address"
    },
    "to": {
      "$ref": "canonical-address.schema.json#/definitions/CanonicalAddress",
      "description": "Recipient's canonical address"
    },
    "payload": {
      "description": "Message-specific payload (type varies by message type)"
    },
    "pattern": {
      "type": "string",
      "enum": ["tell", "ask"],
      "description": "Routing pattern for the message (tell=fire-and-forget, ask=request-response)"
    },
    "timestamp": {
      "type": "integer",
      "description": "Epoch milliseconds when message was created",
      "minimum": 0
    },
    "correlationId": {
      "oneOf": [
        { "type": "string", "format": "uuid" },
        { "type": "null" }
      ],
      "description": "UUID for correlating request-response pairs"
    },
    "ttl": {
      "oneOf": [
        { "type": "integer", "minimum": 0 },
        { "type": "null" }
      ],
      "description": "Time-to-live in milliseconds"
    },
    "metadata": {
      "type": "object",
      "description": "Optional metadata for message routing and debugging",
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}
